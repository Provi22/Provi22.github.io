<!DOCTYPE html>
<html lang="{{ site.lang | default: "en-US" }}">
  <head>
    <meta charset="UTF-8">

    {% seo %}
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="preload" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700&display=swap" as="style" type="text/css" crossorigin>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#155996">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="stylesheet" href="{{ '/assets/css/style.css?v=' | append: site.github.build_revision | relative_url }}">
    <link rel="stylesheet" href="{{ '/assets/css/custom.css' | relative_url }}">
    {% include head-custom.html %}
  </head>
  <body>
    <a id="skip-to-content" href="#content">Skip to the content.</a>

    <!-- Dynamic NAV BAR container -->
    <nav id="navbar" class="navbar"></nav>

    <!-- Cayman banner -->
    <header class="page-header" role="banner">
      <h1 class="project-name">{{ page.title | default: site.title | default: site.github.repository_name }}</h1>
      <h2 class="project-tagline">{{ page.description | default: site.description | default: site.github.project_tagline }}</h2>
      {% if site.github.is_project_page %}
        <a href="{{ site.github.repository_url }}" class="btn">View on GitHub</a>
      {% endif %}
      {% if site.show_downloads %}
        <a href="{{ site.github.zip_url }}" class="btn">Download .zip</a>
        <a href="{{ site.github.tar_url }}" class="btn">Download .tar.gz</a>
      {% endif %}
    </header>

    <!-- Main content -->
    <main id="content" class="main-content" role="main">
      {{ content }}

      <footer class="site-footer">
        {% if site.github.is_project_page %}
          <span class="site-footer-owner">
            <a href="{{ site.github.repository_url }}">{{ site.github.repository_name }}</a> 
            is maintained by <a href="{{ site.github.owner_url }}">{{ site.github.owner_name }}</a>.
          </span>
        {% endif %}
        <span class="site-footer-credits">
          This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.
        </span>
      </footer>
    </main>

    <!-- Scripts -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        let currentPath = window.location.pathname;
        if (!currentPath.endsWith("/")) currentPath += "/";

        const isSpanish = currentPath === "/es/" || currentPath.match(/\/[^/]+\/es\/$/);

        const navbar = document.getElementById("navbar");

        const navData = {
          en: {
            brand: "Home",
            projects: "Projects ▼",
            unrelated: "Unrelated ▼",
            links: [
              { text: "Aruba 205H Wall Bracket", href: "/aruba/" },
              { text: "Engine rebuilds and teardowns", href: "/engines/" },
              { text: "3D Printed RC Car", href: "/rc/" },
              { text: "Future projects", href: "/future/" },
              { text: "About me", href: "/about/" },
              { text: "Useful links", href: "/links/" }
            ]
          },
          es: {
            brand: "Inicio",
            projects: "Proyectos ▼",
            unrelated: "No relacionado ▼",
            links: [
              { text: "Soporte de pared Aruba 205H", href: "/aruba/es/" },
              { text: "Reconstrucción y desarme de motores", href: "/engines/es/" },
              { text: "Coche RC impreso en 3D", href: "/rc/es/" },
              { text: "Proyectos futuros", href: "/future/es/" },
              { text: "Sobre mí", href: "/about/es/" },
              { text: "Enlaces útiles", href: "/links/es/" }
            ]
          }
        };

        const lang = isSpanish ? "es" : "en";
        const t = navData[lang];

        // Build navbar HTML
        navbar.innerHTML = `
          <div class="nav-left">
            <a href="${isSpanish ? '/es/' : '/'}" class="brand">${t.brand}</a>

            <div class="dropdown">
              <a href="#" class="dropbtn">${t.projects}</a>
              <div class="dropdown-content">
                <a href="${t.links[0].href}">${t.links[0].text}</a>
                <a href="${t.links[1].href}">${t.links[1].text}</a>
                <a href="${t.links[2].href}">${t.links[2].text}</a>
                <a href="${t.links[3].href}">${t.links[3].text}</a>
              </div>
            </div>

            <div class="dropdown">
              <a href="#" class="dropbtn">${t.unrelated}</a>
              <div class="dropdown-content">
                <a href="${t.links[4].href}">${t.links[4].text}</a>
                <a href="${t.links[5].href}">${t.links[5].text}</a>
              </div>
            </div>
          </div>

          <div class="nav-right">
            <button id="lang-toggle">${isSpanish ? "EN" : "ES"}</button>
            <button class="hamburger" id="hamburger">☰</button>
          </div>
        `;

        // Language toggle logic (updated)
        const langBtn = document.getElementById("lang-toggle");
        langBtn.addEventListener("click", function () {
          let newPath = currentPath;

          if (isSpanish) {
            // Spanish → English
            newPath = newPath.replace(/\/es\/$/, "/"); // e.g. /aruba/es/ → /aruba/
            newPath = newPath.replace(/^\/es\/$/, "/"); // root /es/ → /
          } else {
            // English → Spanish
            if (newPath === "/") {
              newPath = "/es/";
            } else if (!newPath.endsWith("es/")) {
              newPath += "es/";
            }
          }

          window.location.href = newPath;
        });

        // Dropdown toggle
        navbar.querySelectorAll(".dropdown .dropbtn").forEach(btn => {
          btn.addEventListener("click", function (e) {
            e.preventDefault();
            const content = this.nextElementSibling;
            content.classList.toggle("show");
            navbar.querySelectorAll(".dropdown-content").forEach(menu => {
              if (menu !== content) menu.classList.remove("show");
            });
          });
        });

        // Close dropdowns if clicking outside
        window.addEventListener("click", function (e) {
          if (!e.target.matches(".dropbtn")) {
            navbar.querySelectorAll(".dropdown-content").forEach(menu => {
              menu.classList.remove("show");
            });
          }
        });

        // Hamburger toggle
        const hamburger = document.getElementById("hamburger");
        hamburger.addEventListener("click", function () {
          navbar.classList.toggle("open");
        });
      });
    </script>
  </body>
</html>
