<!DOCTYPE html>
<html lang="{{ site.lang | default: 'en-US' }}">
<head>
  <meta charset="UTF-8">
  {% seo %}
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link rel="preload" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700&display=swap" as="style" type="text/css" crossorigin>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#155996">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="stylesheet" href="{{ '/assets/css/style.css?v=' | append: site.github.build_revision | relative_url }}">
  <link rel="stylesheet" href="{{ '/assets/css/custom.css' | relative_url }}">
  {% include head-custom.html %}
</head>
<body>

  <nav id="navbar" class="navbar"></nav>

  <header class="page-header" role="banner">
    <h1 class="project-name">{{ page.title | default: site.title | default: site.github.repository_name }}</h1>
    <h2 class="project-tagline">{{ page.description | default: site.description | default: site.github.project_tagline }}</h2>
    {% if site.github.is_project_page %}
      <a href="{{ site.github.repository_url }}" class="btn">View on GitHub</a>
    {% endif %}
    {% if site.show_downloads %}
      <a href="{{ site.github.zip_url }}" class="btn">Download .zip</a>
      <a href="{{ site.github.tar_url }}" class="btn">Download .tar.gz</a>
    {% endif %}
  </header>

  <main id="content" class="main-content" role="main">
    {{ content }}
  </main>

  <script>
  document.addEventListener("DOMContentLoaded", function() {
    let currentPath = window.location.pathname;
    if (!currentPath.endsWith("/")) currentPath += "/";

    // Detect Spanish if URL ends with "/es/" inside any directory or is exactly "/es/"
    const isSpanish = /\/es\/$/.test(currentPath);

    const navbar = document.getElementById("navbar");

    const navData = {
      en: {
        brand: "Home",
        projects: "Projects ▼",
        unrelated: "Unrelated ▼",
        links: [
          { text: "Aruba 205H Wall Bracket", href: "/aruba/" },
          { text: "Engine rebuilds and teardowns", href: "/engines/" },
          { text: "3D Printed RC Car", href: "/rc/" },
          { text: "Future projects", href: "/future/" },
          { text: "About me", href: "/about/" },
          { text: "Useful links", href: "/links/" }
        ]
      },
      es: {
        brand: "Inicio",
        projects: "Proyectos ▼",
        unrelated: "No relacionado ▼",
        links: [
          { text: "Soporte de pared Aruba 205H", href: "/aruba/es/" },
          { text: "Revisión y despiece de motores", href: "/engines/es/" },
          { text: "Coche RC impreso en 3D", href: "/rc/es/" },
          { text: "Proyectos futuros", href: "/future/es/" },
          { text: "Sobre mí", href: "/about/es/" },
          { text: "Enlaces útiles", href: "/links/es/" }
        ]
      }
    };

    const lang = isSpanish ? "es" : "en";
    const t = navData[lang];

    navbar.innerHTML = `
      <div class="nav-left">
        <a href="${ isSpanish ? '/es/' : '/' }" class="brand">${t.brand}</a>

        <div class="dropdown">
          <a href="#" class="dropbtn">${t.projects}</a>
          <div class="dropdown-content">
            <a href="${t.links[0].href}">${t.links[0].text}</a>
            <a href="${t.links[1].href}">${t.links[1].text}</a>
            <a href="${t.links[2].href}">${t.links[2].text}</a>
            <a href="${t.links[3].href}">${t.links[3].text}</a>
          </div>
        </div>

        <div class="dropdown">
          <a href="#" class="dropbtn">${t.unrelated}</a>
          <div class="dropdown-content">
            <a href="${t.links[4].href}">${t.links[4].text}</a>
            <a href="${t.links[5].href}">${t.links[5].text}</a>
          </div>
        </div>
      </div>

      <div class="nav-right">
        <button id="lang-toggle">${ isSpanish ? "EN" : "ES" }</button>
        <button class="hamburger" id="hamburger">☰</button>
      </div>
    `;

    // Language toggle
    document.getElementById("lang-toggle").addEventListener("click", function() {
      let newPath;
      if (isSpanish) {
        // remove the trailing /es/
        newPath = currentPath.replace(/\/es\/$/, "/");
      } else {
        // add /es/ to the end of the current directory
        newPath = currentPath + "es/";
      }
      window.location.href = newPath;
    });

    // Dropdown toggles
    navbar.querySelectorAll(".dropdown .dropbtn").forEach(btn => {
      btn.addEventListener("click", function(e) {
        e.preventDefault();
        const content = this.nextElementSibling;
        content.classList.toggle("show");
        navbar.querySelectorAll(".dropdown-content").forEach(m => {
          if (m !== content) m.classList.remove("show");
        });
      });
    });

    window.addEventListener("click", function(e) {
      if (!e.target.matches(".dropbtn")) {
        navbar.querySelectorAll(".dropdown-content").forEach(m => m.classList.remove("show"));
      }
    });

    const hamburger = document.getElementById("hamburger");
    if (hamburger) {
      hamburger.addEventListener("click", function() {
        navbar.classList.toggle("open");
      });
    }
  });
  </script>
</body>
</html>
